<?xml version="1.0" encoding="UTF-8"?>
<applications xmlns="http://www.wabacus.com"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.wabacus.com ../xsd/wabacus.applications.xsd">
	<page id="out" js="/webresources/script/validate.js">
		<header>
			<![CDATA[<p align="center"><font size="6"><b>出库管理</b></font></p>]]>
		</header>
		<report id="report1" title="request{txtname}库存信息" rowselect="multiple-checkbox" type="editablelist" >
				<display mouseoverbgcolor="CCCCCC" >
				<col column="{col-rowselect}" width="20"></col>
					<col column="id" label="序号"  displaytype="hidden"/>
					<col column="catname" label="名称"  clickorderby="true" width="25%"/>
					<col column="catno" label="货号"  clickorderby="true" width="10%"/>					
					<col column="batchno" label="批号" clickorderby="true" width="10%"></col>		
					<col column="localprice" label="单价CNY" datatype="float" clickorderby="true" width="10%"></col>
					<col column="total" label="数量" clickorderby="true" datatype="int" width="10%"></col>
					<col column="expiredate" label="有效期" datatype="date{yyyy-MM-dd}" clickorderby="true" width="10%"></col>
					<col column="producer" label="生产商" clickorderby="true" width="15%"></col>
					<col column="{editablelist-edit}" label="出库操作"></col>
				</display>
			<sql>
				<select>
					<value>
						<![CDATA[SELECT id,catno,catname,batchno,round(localprice,2) localprice,total, expiredate ,producer FROM b_cat  where  total>0 and {#condition#} order by expiredate]]>
					</value>
					<condition name="txtid" hidden="true">
						<value>
						<![CDATA[(ID = '#data#' )]]>
						</value>
					</condition>						
				    <condition name="catname" label="名称" labelposition="left">
						     <value>
							<![CDATA[(trim(catname) like  '%#data#%' )]]>
						</value>
						     <inputbox>
						        <typeprompt width="-1" count="20">
							       <promptcol label="catname" matchmode="anywhere"></promptcol>
							       <datasource>    
							          <option dataset="@{select distinct catname from d_catcode where {#matchcondition#}}"></option> 
                                   </datasource>
						        </typeprompt>
						     </inputbox>
					    </condition>
				    <condition name="batchno" label="批号" labelposition="left">
						<value>
							<![CDATA[(trim(catno) like  '%#data#%' )]]>
						</value>						   
					    </condition>
						
						 
				</select>
				<update pageurl="report{out_add.report1}" urlparams="txtid=@{id}"
						popupparams="{title:'出库',width:800,height:400}">
				</update>  	
			</sql>
			<format><!--
				<value>
					rrequest.getRequest().setAttribute("txtname",name);//存放request，以便显示标题时能取到
				</value>
			--></format>
		</report>
		<report id="report2" title="request{txtname}出库信息" rowselect="multiple-checkbox" type="editablelist" >
				<display mouseoverbgcolor="CCCCCC" >
				<col column="{col-rowselect}" width="20"></col>
					<col column="id" label="编号"  displaytype="hidden"/>
					<col column="outdate" label="出库日期" clickorderby="true" datatype="date{yyyy-MM-dd}" width="10%"></col>
					<col column="catno" label="货号"  clickorderby="true" width="10%"/>
					<col column="catname" label="名称"  clickorderby="true" width="20%"/>
					<col column="batchno" label="批号" clickorderby="true" width="10%"></col>
					<col column="localprice" label="单价CNY" datatype="float" clickorderby="true" width="10%"></col>
					<col column="num" label="数量" datatype="int" clickorderby="true" width="5%"></col>
					<col column="machinename" label="设备"  clickorderby="true" width="10%"/>
					<col column="machineno" label="设备序号"  clickorderby="true" width="10%"/>
					<col column="reason" label="原因" clickorderby="true" width="15%"></col>
					<col column="{editablelist-edit}" label="修改出库"></col>
				</display>
			<sql>
				<select>
					<value>
						<![CDATA[SELECT id,catno,catname,machinename,machineno,batchno,person,outdate,round(localprice,2) localprice,num,(select codename from d_code where code=reason and codetype='outreason') reason FROM b_out  where  {#condition#}]]>
					</value>
					<condition name="txtid" hidden="true">
						<value>
						<![CDATA[(ID = '#data#' )]]>
						</value>
					</condition>
				</select>	
				
				<update pageurl="report{out_edit.report1}" urlparams="txtid=@{id}"
						popupparams="{title:'更新出库',width:800,height:400}">
				</update>  
				<delete confirmessage="是否删除[@{batchno}]对应的记录？">
						delete from b_out where id=@{id__old};
					  </delete>	
			</sql>
			<format><!--
				<value>
					rrequest.getRequest().setAttribute("txtname",name);//存放request，以便显示标题时能取到
				</value>
			--></format>
		</report>
	</page>
	
</applications>